## Работа с аппаратными интерфейсами: I²C, Serial и другие низкоуровневые устройства

В VRack2 часто возникает необходимость взаимодействия с физическими устройствами через интерфейсы вроде **I²C**, **UART (Serial)**, **SPI** или **GPIO**. Однако такие интерфейсы имеют особенности, которые важно учитывать при проектировании сервисов.

### Почему это не так просто?

Библиотеки вроде `i2c-bus`, `serialport` и другие часто содержат **нативные аддоны**, скомпилированные под конкретную версию Node.js. Более того, многие из них **не поддерживают многоконтекстную загрузку**, что делает их **несовместимыми с `worker_threads`** — механизма, который VRack2 использует для изоляции независимых сервисов.

Попытка импортировать такие модули внутри Worker'а приведёт к ошибке вида:

```
Error: Module did not self-register: '.../i2c.node'
```

Это не баг VRack2 и не ошибка установки — это **ограничение архитектуры самих нативных модулей**.

### Как правильно работать с такими устройствами в VRack2?

VRack2 предлагает **два проверенных подхода**:

#### 1. **VGranite — внешний сервис-транслятор**

**[VGranite](https://github.com/VRack2/vgranite)** — это лёгкое приложение, которое создаёт **сетевые туннели** между TCP/Socket и физическими портами (Serial).  

Принцип работы:
- VGranite запускается **отдельным процессом** на той же машине, где работает VRack2,
- Он открывает, например, `/dev/ttyUSB0` и слушает TCP-порт (например, `localhost:8081`),
- Любое приложение (включая VRack2-устройства) может подключиться к этому порту как к обычному сокету и обмениваться данными.

Преимущества:
- Полная изоляция от нативных модулей в VRack2,
- Возможность использовать Serial даже из Worker'ов (через обычный `net` или `WebSocket`),
- Простота развёртывания и отладки.

> VGranite особенно удобен, когда вы хотите **абстрагироваться от физического уровня** и работать с устройством как с сетевым сервисом.

#### 2. **Собственное устройство в основном сервисе VRack2**

Если вы предпочитаете **оставаться в рамках VRack2**, создайте **специализированное устройство**, которое:
- Запускается **в основном потоке** (не в Worker'е!),
- Использует `i2c-bus`, `serialport` или другие библиотеки напрямую,

Сложность данного подхода в том, что нужно предоставить интерфейс общения внутри `worker_threads` сервисов VRack2. Этот подход требует углубленных знаний работы самого VRack2. В будущем планируется упростить данный процесс и предоставить пользовалетю простой способ для решения данной проблемы.